<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="780" viewBox="0 0 1400 780">
  <defs>
    <style>
      .title { font: 700 28px sans-serif; fill: #111827; }
      .subtitle { font: 600 18px sans-serif; fill: #111827; }
      .text { font: 16px sans-serif; fill: #111827; }
      .muted { font: 14px sans-serif; fill: #374151; }
      .box { fill: #ffffff; stroke: #111827; stroke-width: 2; rx: 14; }
      .box2 { fill: #f9fafb; stroke: #111827; stroke-width: 2; rx: 14; }
      .lane { fill: #f3f4f6; stroke: #9ca3af; stroke-width: 2; rx: 18; }
      .arrow { stroke: #111827; stroke-width: 3; fill: none; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#111827"/>
    </marker>
  </defs>

  <rect x="0" y="0" width="1400" height="780" fill="#ffffff"/>
  <text x="40" y="60" class="title">Tiny-Agents：RAG 总览图（离线建库 + 在线检索问答 + 引用定位）</text>
  <text x="40" y="92" class="muted">说明：该图用于 README 展示整体链路，强调证据检索、融合重排、以及最终回答的可追溯引用。</text>

  <rect x="40" y="130" width="1320" height="260" class="lane"/>
  <text x="70" y="165" class="subtitle">离线阶段：数据摄取与建库</text>

  <rect x="80" y="200" width="260" height="130" class="box"/>
  <text x="110" y="235" class="text">原始数据</text>
  <text x="110" y="265" class="muted">PDF / DOCX / PPTX</text>
  <text x="110" y="288" class="muted">TXT / Markdown / JSONL</text>
  <text x="110" y="311" class="muted">法律库：民法典 / 刑法 / 宪法</text>

  <rect x="380" y="200" width="290" height="130" class="box2"/>
  <text x="410" y="235" class="text">摄取与结构化解析</text>
  <text x="410" y="265" class="muted">通用 reader：按格式读取</text>
  <text x="410" y="288" class="muted">法律 parser：按编/章/节/条拆分</text>
  <text x="410" y="311" class="muted">元数据：law/book/chapter/section/article</text>

  <rect x="710" y="200" width="290" height="130" class="box2"/>
  <text x="740" y="235" class="text">切分与切块</text>
  <text x="740" y="265" class="muted">SentenceSplitter 规则/模型分句</text>
  <text x="740" y="288" class="muted">法条合并：避免枚举项过碎</text>
  <text x="740" y="311" class="muted">输出：split_sentence.jsonl</text>

  <rect x="1040" y="200" width="280" height="130" class="box"/>
  <text x="1070" y="235" class="text">构建索引与落盘</text>
  <text x="1070" y="265" class="muted">BM25 语料缓存</text>
  <text x="1070" y="288" class="muted">FAISS 向量索引</text>
  <text x="1070" y="311" class="muted">目录：data/db/&lt;库名&gt;</text>

  <path class="arrow" d="M 340 265 L 380 265"/>
  <path class="arrow" d="M 670 265 L 710 265"/>
  <path class="arrow" d="M 1000 265 L 1040 265"/>

  <rect x="40" y="420" width="1320" height="320" class="lane"/>
  <text x="70" y="455" class="subtitle">在线阶段：检索增强问答（可走 ReAct 或直接 RAG）</text>

  <rect x="80" y="495" width="240" height="120" class="box"/>
  <text x="110" y="530" class="text">用户问题</text>
  <text x="110" y="560" class="muted">例如：合同未约定价款如何处理</text>
  <text x="110" y="585" class="muted">例如：第一千零三条规定了什么</text>

  <rect x="350" y="495" width="260" height="120" class="box2"/>
  <text x="380" y="530" class="text">多路召回</text>
  <text x="380" y="560" class="muted">BM25 关键字召回</text>
  <text x="380" y="585" class="muted">向量召回（可选 HyDE 改写）</text>

  <rect x="640" y="495" width="260" height="120" class="box2"/>
  <text x="670" y="530" class="text">融合与候选池</text>
  <text x="670" y="560" class="muted">去重融合 / RRF 融合</text>
  <text x="670" y="585" class="muted">得到候选证据片段列表</text>

  <rect x="930" y="495" width="240" height="120" class="box2"/>
  <text x="960" y="530" class="text">重排（rerank）</text>
  <text x="960" y="560" class="muted">交叉编码器精排</text>
  <text x="960" y="585" class="muted">输出 TopK 证据</text>

  <rect x="1200" y="475" width="160" height="160" class="box"/>
  <text x="1228" y="515" class="text">最终回答</text>
  <text x="1228" y="545" class="muted">基于证据生成</text>
  <text x="1228" y="568" class="muted">并附引用</text>
  <text x="1228" y="591" class="muted">法条可定位到</text>
  <text x="1228" y="614" class="muted">编/章/节/条</text>

  <path class="arrow" d="M 320 555 L 350 555"/>
  <path class="arrow" d="M 610 555 L 640 555"/>
  <path class="arrow" d="M 900 555 L 930 555"/>
  <path class="arrow" d="M 1170 555 L 1200 555"/>

  <text x="80" y="720" class="muted">ReAct 模式：模型输出 Action → 工具返回 Observation → 模型输出 Final；引用信息直接来自 Observation 的 source 字段。</text>
</svg>

