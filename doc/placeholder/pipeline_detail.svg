<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="820" viewBox="0 0 1400 820">
  <defs>
    <style>
      .title { font: 700 28px sans-serif; fill: #111827; }
      .subtitle { font: 600 18px sans-serif; fill: #111827; }
      .text { font: 16px sans-serif; fill: #111827; }
      .muted { font: 14px sans-serif; fill: #374151; }
      .box { fill: #ffffff; stroke: #111827; stroke-width: 2; rx: 14; }
      .box2 { fill: #f9fafb; stroke: #111827; stroke-width: 2; rx: 14; }
      .lane { fill: #f3f4f6; stroke: #9ca3af; stroke-width: 2; rx: 18; }
      .arrow { stroke: #111827; stroke-width: 3; fill: none; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#111827"/>
    </marker>
  </defs>

  <rect x="0" y="0" width="1400" height="820" fill="#ffffff"/>
  <text x="40" y="60" class="title">检索流水线细节图（recall → fusion → rerank）</text>
  <text x="40" y="92" class="muted">说明：该图用于 README 展示检索层解耦后的模块边界与可插拔点，并强调法律元数据用于引用定位。</text>

  <rect x="40" y="130" width="1320" height="650" class="lane"/>
  <text x="70" y="165" class="subtitle">SearchPipeline（统一编排）</text>

  <rect x="90" y="210" width="360" height="220" class="box2"/>
  <text x="120" y="245" class="text">Recall（召回提供者）</text>
  <text x="120" y="275" class="muted">SingleDBRecallProvider</text>
  <text x="120" y="298" class="muted">MultiDBRecallProvider</text>
  <text x="120" y="325" class="muted">输出：BM25 列表 + 向量召回列表</text>
  <text x="120" y="352" class="muted">每条包含 item/text + meta + score/dist</text>

  <rect x="510" y="210" width="360" height="220" class="box2"/>
  <text x="540" y="245" class="text">Fusion（融合策略）</text>
  <text x="540" y="275" class="muted">dedup_fuse：去重拼接</text>
  <text x="540" y="298" class="muted">rrf_fuse：RRF 融合（可配置权重）</text>
  <text x="540" y="325" class="muted">输入：两路召回结果</text>
  <text x="540" y="352" class="muted">输出：候选 items（统一候选池）</text>

  <rect x="930" y="210" width="390" height="220" class="box2"/>
  <text x="960" y="245" class="text">Rerank（重排）</text>
  <text x="960" y="275" class="muted">交叉编码器（例如 BGE reranker）</text>
  <text x="960" y="298" class="muted">输入：query + candidates</text>
  <text x="960" y="325" class="muted">输出：按相关性排序后的 TopK 证据</text>
  <text x="960" y="352" class="muted">返回：(score, item) 列表</text>

  <path class="arrow" d="M 450 320 L 510 320"/>
  <path class="arrow" d="M 870 320 L 930 320"/>

  <rect x="90" y="480" width="1230" height="250" class="box"/>
  <text x="120" y="515" class="text">Evidence Items（证据片段结构）</text>
  <text x="120" y="545" class="muted">item 通常为 {id, text, meta}，meta 至少包含 source_path；PDF 还包含 page。</text>
  <text x="120" y="570" class="muted">法律库额外包含：law、book、chapter、section、article，用于引用定位到“编/章/节/条”。</text>
  <text x="120" y="595" class="muted">示例：source=.../xingfa.txt | 中华人民共和国刑法 | 第一编 总则 | 第一章 ... | 未分节 | 第一条</text>
  <text x="120" y="635" class="muted">ReAct 工具 rag_search 会把 items 格式化为 Observation，Final 必须只引用 Observation 中真实存在的编号与 source。</text>

  <path class="arrow" d="M 1120 430 L 1120 480"/>
  <text x="1140" y="460" class="muted">TopK 证据</text>
</svg>

